packages: # "packages/list.art"
do relative "getrepodetails.art"

do ::
    IsCI?: true
    cnt: 1
    total: size packages

    hasError?: false
    problemWithRepo: new []

    loop packages [name,location][
        prints [pad to :string cnt 4 "/" pad.right to :string total 4 "|"]
        prints color #cyan "Processing: "
        prints pad.right name 20 

        [owner,repo]: split.by:"/" location
        (getRepoInfo owner repo)? -> print color #green "[ ✅  OK   ]"                  
        [
            print color #red "[ ⛔️ ERROR ]"
            'problemWithRepo ++ ~"|owner|/|repo|"
            hasError?: true
        ]
        cnt: cnt + 1
    ]

    (hasError?)? [
        unless empty? problemWithRepo [
            print "Couldn't retrieve repo info for:"
            print.lines problemWithRepo
        ]
        panic.code:1 "Something went wrong. Let's fix everything before merging!"
    ][
        print color #green "Everything went fine! 🔥🔥🔥"
        exit
    ]